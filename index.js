//CALLEDHXX Nov/2024

let Squares = [
    {

        Name:"æ­¡è¿å…‰è‡¨",

        Details:"æŒ‰ä¸‹ Enter ç¹¼çºŒã€‚",

        Image:"",

        Page:"/f/welcome.json",

        Color: "8aa93c",

        states:[
            ["ğŸŒ´","æ­¡æ¨‚å³¶"]
        ],

        id : "wel"

    },
    {

        Name:"å€‹äººæª”æ¡ˆ",

        Details:"Hxxçš„å€‹äººæª”æ¡ˆã€‚",

        Image:"/f/img/0324.gif",

        Page:"/f/main.json",

        Color: "5d3ca9",

        states:[
            ["ğŸ˜—","å¥½å–”"]
        ],

        id : "hxx"

    },

    {
        Name:"7SunFish",
        Details:"Hxxçš„å¥½æœ‹å‹",
        Image:"/f/img/a9a72e835d8a6266b636180a30014def.png",
        Page:"/f/7sf.json",
        Color: "c1842b",

        states:[
            ["ğŸŸ","é­šåœ‹åœ‹ç‹"],
            ["ğŸ¦„","ã€Œç¨ã€å®¶"]
        ],

        id : "7sf"

    },
    {
        Name:"æˆ‘æ‰€å°ä¸èµ·çš„ä½ ",
        Details:"ç»çµ¦ä½ ï¼Œæœ‹å‹ã€‚",
        Image:"",
        Page:"/f/sry.json",
        Color: "4e46b8",

        states:[
            ["ğŸ¦„","ã€Œç¨ã€å®¶"],
            ["ğŸ”®","å¦å€‹ä¸–ç•Œ"],

        ],

        id : "sry"

    },
    {
        Name:"Uziç‰¹å¯«",
        Details:"Uziçš„ç‰¹å¯«ç…§å¤–æµã€‚",
        Image:"/f/img/IMG_9089.jpg",
        Page:"/f/uzi.json",
        Color: "7946b8",

        states:[
            ["ğŸ”®","å¦å€‹ä¸–ç•Œ"],
            ["ğŸ¤–","é­”è…¦"],

        ],

        id : "uzi"

    },
    {
        Name:"æ•£æ–‡é›†ï¼šçŸ­",
        Details:"Hxxçš„å€‹äººæ•£æ–‡å°ˆè¼¯ã€‚",
        Image:"",
        Page:"/f/fshort.json",
        Color: "4699d9",

        states:[
            ["ğŸ˜¶â€ğŸŒ«ï¸","ç¾ç¾"],
            ["ğŸ˜–","è…¦ç¾"],

        ],

        id : "fshort"
    },
    {
        Name:"æ•£æ–‡é›†ï¼šé•·",
        Details:"Hxxçš„å€‹äººæ•£æ–‡å°ˆè¼¯ã€‚",
        Image:"",
        Page:"/f/flong.json",
        Color: "d94646",

        id : "flong"
    },
    {
        Name:"Minecraft",
        Details:"Hxxçš„éŠç©Minecraftçš„ç´€éŒ„ã€‚",
        Image:"/f/img/minecraft.png",
        Page:"/f/minecraft.json",
        Color: "85471d",

        id : "minecraft",

        states:[
            [
                "ğŸ€","å¥½ä¿¡é‹"
            ],
            [
                "ğŸ³","ã€Œé¯¨ã€è¨ä¸å·²"
            ],
            [
                "ğŸª","æˆ‘ä¸çŸ¥é“é€™æ˜¯ç”šéº¼"
            ]
        ]

    },
    {
        Name:"èŠ™è‰è“®",
        Details:"èŠ™è‰è“®æˆ°å“ç‰¹ç´šã€‚",
        Image:"/f/img/IMG_9684 - è¤‡è£½.jpg",
        Page:"/f/fll.json",
        Color: "56c4cb",

        states:[
            ["ğŸ¥°","ã„’ã„§Ë‡æ„›"],
        ],

        id : "fll"
    },
    {
        Name:"Hxxåœ–ç‰‡æ”¯æ´",
        Details:"éƒ¨åˆ†åª’é«”å·²æ¨™å‡ºåŸå‡ºè™•ã€‚",
        Image:"/f/img/IMG_E8875.JPG",
        Page:"/f/memes.json",
        Color: "a849a8",

        id : "memes",

        states:[
            [
                "â­","ç²¾é¸"
            ],
            [
                "ğŸ« ","å¥½é…·"
            ],
            [
                "ğŸ«¨","æšˆæšˆçš„"
            ],
        ]
    },
    {
        Name:"å¥½åƒé¦¬éˆ´è–¯",
        Details:"ç™¼éœ‰çš„é¦¬éˆ´è–¯ã€‚",
        Image:"/f/img/472562154_578862491593902_4960175299312110464_n (1) - è¤‡è£½.jpg",
        Page:"/f/potato.json",
        Color: "b06340",

        states:[
            ["ğŸ¦„","ã€Œç¨ã€å®¶"],
            ["ğŸ¥¶ï¸","ç¾æ¾€"],

        ],

        id : "potato"
    },
    {
        Name:"Roblox",
        Details:"è®“Hxxæ‰“é–‹å¦æ‰‡å¤§é–€çš„åª’ä»‹ã€‚",
        Image:"/f/img/è¢å¹•æ“·å–ç•«é¢ 2024-12-22 091330.png",
        Page:"/f/roblox.json",
        Color: "4d2f28",

        states:[
            ["ğŸ¤š","\"Touch grass\""],
            ["ğŸ«","è½†è½†è½†è½†è½†"],
            ["ğŸª¨","ç¡¬æ ¸:skull:"]

        ],

        id : "roblox"
    },
    {
        Name:"MiSide",
        Details:"éå¸¸æ¨è–¦çš„ææ€–éŠæˆ²ï¼",
        Image:"/f/img/è¢å¹•æ“·å–ç•«é¢ 2025-01-24 164159.png",
        Page:"/f/MiSide.json",
        Color: "642881",

        states:[
            ["ğŸ¤©","è¶…æ„›"],
            ["ğŸ˜","æ„›æ­»äº†"],

        ],

        id : "miside"
    },
    {
        Name:"Mioneèªè¨€",
        Details:"Hxxåœ¨é–‹ç™¼çš„ç¨‹å¼èªè¨€ï¼",
        Image:"",
        Page:"/f/mione.json",
        Color: "812862",

        states:[
            ["ğŸ–¥ï¸","å—¶å—¶å•µå•µå—¶å—¶ï¼"],
            ["â­","éå¸¸é…·"],

        ],

        id : "mione"
    },
    {
        Name:"éå¸¸ç ´çš„é­š",
        Details:"åˆProåˆç ´çš„é­šç¨®ã€‚",
        Image:"/f/img/32f8f2203ecb889671ddd843e2d737b9.png",
        Page:"/f/mione.json",
        Color: "9fa6a5",

        states:[
            ["ğŸ«§","å•µå•µå•µï¼Œç¼ºæ°§"],
            ["ğŸ¦„","ã€Œç¨ã€å®¶"],

        ],

        id : "mione"
    },
    {
        Name:"æ°´æ³¥äººDummy",
        Details:"æ›¾ç¶“å…¥æµ·æˆæ¶ˆæ³¢å¡Šã€‚",
        Image:"/f/img/è¢å¹•æ“·å–ç•«é¢ 2025-01-27 203611.png",
        Page:"/f/mione.json",
        Color: "5879de",

        states:[
            ["ğŸ§±","å¿«æ›¬æˆç£šäº†"],
            ["ğŸª¨","ä»–çš„ç¥–å…ˆ"],

        ],

        id : "mione"
    },
    {
        Name:"IronManè‚›éµäºº",
        Details:"ä»–åå­å¾ˆåƒIronManã€‚",
        Image:"/f/img/148810bbcbcc4db37d2ec8188a8a6399.png",
        Page:"/f/mione.json",
        Color: "b26715",

        states:[
            ["ğŸ¦Š","æ¯›æ¯›der"],
            ["ğŸ˜®","å¾ˆé…·"],

        ],

        id : "mione"
    },
    {
        Name:"DJ JD",
        Details:"JDåŒæ™‚ä¹Ÿæ˜¯ç´„æœƒè»Ÿé«” :o",
        Image:"/f/img/52929faad24d847a8c75de0d10dd082e.png",
        Page:"/f/mione.json",
        Color: "478ab7",

        states:[
            ["ğŸª²","ç¬¬äºŒä»£Bugå¤§å¸«"],
            ["ğŸ’€",":skull:"],

        ],

        id : "mione"
    },
    {
        Name:"é†«ç”Ÿå®³æ€•è˜‹æœ",
        Details:"DoctorFishï¼Œå¯èƒ½æœƒæ˜¯é†«ç”Ÿ:OOOO",
        Image:"/f/img/3cefb2f1f8b976328364daafe647af0d.png",
        Page:"/f/mione.json",
        Color: "b78a47",

        states:[
            ["ğŸ","ä»–çš„å¤©æ•µ"],
            ["ğŸ¦„","ã€Œç¨ã€å®¶"],

        ],

        id : "mione"
    },
    {
        Name:"Wenson",
        Details:"æ˜é¡¯æ˜¯ç‚ºæ­£ä»å›å­ã€‚",
        Image:"/f/img/b5e403d11dfed3329ed8a275f9313f7f.png",
        Page:"/f/mione.json",
        Color: "3d739f",

        states:[
            ["ğŸª­","å„ªé›…"],
            ["ğŸ˜®","å¥½é…·"],

        ],

        id : "mione"
    }
]

let BubbleXSize = 900;
let BubbleYSize = 720;

let Bubbles = [

];
let BubbleInfos = [

];

let MidY = 0;
let MidX = 0;

let mapSize;

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

async  function tweenMsgMove(obj,toY,sec,lag){
    let perSecY = (toY-obj.style.bottom.substring(0,obj.style.bottom.length-2))/(sec*10);

    let Y = Number(obj.style.bottom.substring(0,obj.style.bottom.length-2));

    for (let i = 0;i<(10*sec);i++){

        obj.style.bottom = Y+perSecY+"px";

        await sleep(lag);


        Y = Number(obj.style.bottom.substring(0,obj.style.bottom.length-2));
    }

    obj.style.bottom = toY+"px";
}

let msgStyle3d="";

async function MessageIt(Title,Reason){

    if (Title&&Reason){
        let AMessageCase = document.createElement("button");
        AMessageCase.classList.add("AMessageCase");
        await tweenMsgMove(AMessageCase,-300,1,1);
        await sleep(100);



        let MessageTouchBox = document.createElement("div");
        MessageTouchBox.classList.add("MessageTouchBox");

        let MessageImage = document.createElement("img");
        MessageImage.classList.add("MessageImage");
        MessageImage.src = "path248.png";

        let MessageContentCase = document.createElement("div");
        MessageContentCase.classList.add("MessageContentCase");

        let MessageContent1 = document.createElement("h1");
        MessageContent1.classList.add("MessageContent1");
        MessageContent1.textContent = Title;

        let MessageContent2 = document.createElement("h2");
        MessageContent2.classList.add("MessageContent2");
        MessageContent2.textContent = Reason;

        AMessageCase.style.transform = msgStyle3d;

        document.getElementById("MessagesCase").appendChild(AMessageCase);
        AMessageCase.appendChild(MessageTouchBox);
        AMessageCase.appendChild(MessageImage);
        AMessageCase.appendChild(MessageContentCase);
        MessageContentCase.appendChild(MessageContent1);
        MessageContentCase.appendChild(MessageContent2);

        AMessageCase.addEventListener("click", async function(){
            tweenMsgMove(AMessageCase,-500,3,1);
            await sleep(100);
            AMessageCase.remove();
            MessageIt();
        })



        await tweenMsgMove(AMessageCase,0,1,1);

    }




    let papa = document.getElementById("MessagesCase").children;
    //Number(papa[i].id.substring(0,papa[i].id.length-4))
    for (let i = 0;i<papa.length;i++){
        let Index = papa.length - i - 1;
        tweenMsgMove(papa[Index],20*(papa.length - i - 1),1,1);
        await sleep(10);

        papa[Index].style.zIndex = 100+i;
    }



}

let tweenMoveIndex = 0;
let tweenMoveObj;
async  function tweenMove(obj,toX,toY,sec,lag,moveOut){
    tweenMoveObj = obj;
    tweenMoveIndex++;
    let perSecX = (toX-obj.style.left.substring(0,obj.style.left.length-2))/(sec*10);
    let perSecY = (toY-obj.style.top.substring(0,obj.style.top.length-2))/(sec*10);

    let X =  Number(obj.style.left.substring(0,obj.style.left.length-2));
    let Y = Number(obj.style.top.substring(0,obj.style.top.length-2));

    let LastTMI = tweenMoveIndex;

    for (let i = 0;i<(10*sec);i++){
        if (moveOut) if (LastTMI!== tweenMoveIndex) if(obj === tweenMoveObj) break;

        obj.style.left = X+perSecX+"px";
        obj.style.top = Y+perSecY+"px";

        await sleep(lag);


        X =  Number(obj.style.left.substring(0,obj.style.left.length-2));
        Y = Number(obj.style.top.substring(0,obj.style.top.length-2));
    }

    obj.style.left = toX+"px";
    obj.style.top = toY+"px";

}

let tweenSizeIndex = 0;
let tweenSizeObj;

async  function tweenSize(obj,toX,toY,sec,lag,sizeOut){
    tweenSizeObj = obj;
    tweenSizeIndex++;
    let perSecX = (toX-obj.style.width.substring(0,obj.style.width.length-2))/(sec*10);
    let perSecY = (toY-obj.style.height.substring(0,obj.style.height.length-2))/(sec*10);

    let X =  Number(obj.style.width.substring(0,obj.style.width.length-2));
    let Y = Number(obj.style.height.substring(0,obj.style.height.length-2));

    let LastTSI = tweenSizeIndex;


    for (let i = 0;i<(10*sec);i++){
        if (sizeOut) if (LastTSI!== tweenSizeIndex)  if(obj === tweenSizeIndex)  break;


        obj.style.width = X+perSecX+"px";
        obj.style.height = Y+perSecY+"px";

        await sleep(lag);


        X =  Number(obj.style.width.substring(0,obj.style.width.length-2));
        Y = Number(obj.style.height.substring(0,obj.style.height.length-2));
    }



    obj.style.width = toX+"px";
    obj.style.height = toY+"px";


}

async  function tweenPos(obj,toX,toY,sec,lag){
    let perSecX = (toX-obj.style.backgroundPositionX.substring(0,obj.style.backgroundPositionX.length-2))/(sec*10);
    let perSecY = (toY-obj.style.backgroundPositionY.substring(0,obj.style.backgroundPositionY.length-2))/(sec*10);

    let X =  Number(obj.style.backgroundPositionX.substring(0,obj.style.backgroundPositionX.length-2));
    let Y = Number(obj.style.backgroundPositionY.substring(0,obj.style.backgroundPositionY.length-2));



    for (let i = 0;i<(10*sec);i++){

        obj.style.backgroundPositionX = X+perSecX+"px";
        obj.style.backgroundPositionY = Y+perSecY+"px";

        await sleep(lag);


        X =  Number(obj.style.backgroundPositionX.substring(0,obj.style.backgroundPositionX.length-2));
        Y = Number(obj.style.backgroundPositionY.substring(0,obj.style.backgroundPositionY.length-2));
    }



    obj.style.backgroundPositionX = toX+"px";
    obj.style.backgroundPositionY = toY+"px";


}

let Oy = 0;

let LastMidX = 0;
let LastMidY = 0;

let LimSquares = {
    "Moved100" : {

        Name:"ç™¾æ­¥ä¹‹é€”",

        Details:"è‡´ä¸Šæœ€é«˜çš„æ•¬ç¦®",

        Image:"",

        Page:"/f/m100.json",

        Color: "a93c74",

        id : "m100",

        states:[
            [
                "ğŸ«","é§±é§éƒ½æ²’æ¯”ä½ æœ‰è€åŠ›"
            ]
        ]


    },
    "msl" : {

        Name:"å¥‡æ€ªçš„æ—äº®æ•™!",

        Details:"ç¥ä¾†è‡¨",

        Image:"/f/img/IMG_9453 - è¤‡è£½.JPG",

        Page:"/f/msl.json",

        Color: "3b7ec2",

        id : "msl",

        states:[
            [
                "ğŸ˜®","æ•™çš„åŠ›é‡"
            ]
        ]

    }
}

let creatBubble = function(BubbleSqr){ //Create???
    let BubblesTotal= 0;
    for (let _y =0;_y<Bubbles.length; _y++){
        for (let _x=0;_x<Bubbles[_y].length; _x++) BubblesTotal++ ;
    }

    let fit = Math.sqrt(BubblesTotal+1) - Math.floor(Math.sqrt(BubblesTotal+1)) === 0;

    let NewMapSize = fit ? Math.sqrt(BubblesTotal+1) : Math.floor(Math.sqrt(BubblesTotal+1))+1;

    let newBubbles = [];
    let newBubbleInfos = [];

    for (let i = 0; i <NewMapSize; i++) {
        newBubbles[i] = [];
    }

    for (let i = 0; i <BubbleInfos.length; i++) newBubbleInfos[i] = BubbleInfos[i];


    for (let Y = 0; Y < NewMapSize; Y++){
        for (let X = 0; X < NewMapSize; X++){
            if (BubblesTotal<=Y*2+X) break;
            let v = 0;
            for (let yy = 0; yy < mapSize; yy++) {
                for (let xx = 0; xx < mapSize; xx++) {
                    if (Y*NewMapSize+X === yy*mapSize+xx){
                        v = Bubbles[yy][xx];
                        break;
                    }
                }
            }

            if(v){
                newBubbles[Y][X] = v;
            }else{
                if (Y===X&&X===0) newBubbles[Y][X] = v;
            }
        }
    }

    console.log(Bubbles,newBubbles);

    newBubbleInfos[newBubbleInfos.length] = BubbleSqr;

    Bubbles = newBubbles;
    BubbleInfos = newBubbleInfos;
    mapSize = NewMapSize;





    let button = document.createElement("button");
    let h2 = document.createElement("h2");
    let h6 = document.createElement("h6");
    let img = document.createElement("img");


    h2.textContent =BubbleSqr.Name;
    button.style.backgroundColor = "#" + BubbleSqr.Color;
    h2.style.color = "#" + hex(BubbleSqr.Color,"333333", +1);
    h6.style.color = "#" + hex(BubbleSqr.Color,"111111", +1);
    button.style.borderColor = "#" + hex(BubbleSqr.Color,"111111", -1);

    button.style.boxShadow = " 0 0 30px 3px #"+hex(BubbleSqr.Color,"111111", +1);



    let states = document.createElement("div");

    states.classList.add("states");

    if(BubbleSqr.states){
        for (let s = 0;s<BubbleSqr.states.length;s++){
            let aState = document.createElement("h6");
            aState.innerText = BubbleSqr.states[s][0];
            aState.classList.add("aState");
            states.appendChild(aState);
        }
    }

    button.style.left = window.innerWidth/2+"px";
    button.style.top = window.innerHeight/2+"px";

    button.style.width =  "50px";
    button.style.height = "50px";

    button.id = "bubble_"+BubbleSqr.id;

    button.classList.add("Square");

    button.classList.add(BubblesTotal);

    img.classList.add("Icon");

    button.appendChild(img);

    button.appendChild(h2);
    button.appendChild(h6);

    button.appendChild(states);

    document.getElementById("Bubbles").appendChild(button);

    let db = 0;
    for (let Y = 0; Y < mapSize; Y++) {
        for (let X = 0; X < mapSize; X++) {
            if (Y === 0 && X === 0){}else{
                if (Bubbles[Y][X]){}else {
                    Bubbles[Y][X] = BubblesTotal;
                    db = 1;
                    break;
                }
            }
        }
        if (db){
            break;
        }
    }


}

let a = async function(){
    let X = 0;
    let Y = 0;

    let XfirstPix = Math.floor(window.innerWidth/2)-55//Math.floor((mapSize/2)*55);
    let YfirstPix = Math.floor(window.innerHeight/2)-55//Math.floor((mapSize/2)*55);

    let xGen = 60;
    let yGen = 60;

    let CX = Math.floor(MidX/mapSize*30);
    let CY = Math.floor(MidY/mapSize*30);


    //
    let moved = document.cookie.replace(
        /(?:(?:^|.*;\s*)moved\s*\=\s*([^;]*).*$)|^.*$/,
        "$1",
    );

    if (Math.abs(MidX - LastMidX)){
        document.cookie = "moved="+(Number(moved)+1)+";";
    }
    if (Math.abs(MidY - LastMidY)){
        document.cookie = "moved="+(Number(moved)+1)+";";
    }



    if (Number(moved)>=100 && !document.getElementById("bubble_m100")){
        creatBubble(LimSquares["Moved100"]);
        MessageIt("å¥½åƒæœ‰æ±è¥¿ï¼Ÿ","æœ‰ç¥ç§˜æ³¡æ³¡å‡ºä¾†äº†ï¼Œè¶•ç·Šæ‰¾æ‰¾ï¼");
    }


    //

    //

     tweenPos(document.getElementById("BackGround"),-MidX*20,-MidY*20,3,.1);



    //


    for (let y = 0;y<Bubbles.length;y++) {
        X = 0;
        for (let x = 0; x < Bubbles[y].length; x++) {

            if (MidY - y === 0){
                yGen = 120;
            }else{
                yGen = 60;
            }




            if (MidX - x === 0){
                //  document.getElementsByClassName(Bubbles[y][x])[0].style.backgroundColor = "red";

            }else{

                if (MidY - y === 0){
                    // document.getElementsByClassName(Bubbles[y][x])[0].style.backgroundColor = "blue";

                }else{
                    // document.getElementsByClassName(Bubbles[y][x])[0].style.backgroundColor = "red";
                }

            }


            let disY =  (MidX - x === 0 && MidY - y === 0) ? 60 : 0;
            let EasY = 0;

            let SqrData = BubbleInfos[y*mapSize + x];


            if (SqrData){}else{break;}


            if (MidY - y <= -1){
                if (x === MidX || x === MidX+1){
                    //document.getElementsByClassName(Bubbles[y][x])[0].style.backgroundColor = "green";
                }else{
                    EasY =- 60;
                }
            }



            //+ (Number(document.getElementsByClassName(Bubbles[y][x])[0].style.width.substring(0,document.getElementsByClassName(Bubbles[y][x])[0].style.width.length-2)))/5
            //+  (Number(document.getElementsByClassName(Bubbles[y][x])[0].style.height.substring(0,document.getElementsByClassName(Bubbles[y][x])[0].style.height.length-2)))/5


             tweenMove(document.getElementsByClassName(Bubbles[y][x])[0]
                , -MidX*55+XfirstPix+X - CX
                ,-MidY*55+YfirstPix+Y + disY + EasY - CY
                ,
                 .8,
                10,true)




            if (MidX - x === 0 && MidY - y === 0){
                 tweenSize(document.getElementsByClassName(Bubbles[y][x])[0],110,110,.5,10,true);
                xGen = 120;

                document.getElementsByClassName(Bubbles[y][x])[0].children[1].textContent = SqrData.Name;
                document.getElementsByClassName(Bubbles[y][x])[0].children[2].textContent = SqrData.Details;
                document.getElementsByClassName(Bubbles[y][x])[0].children[1].style.fontSize = "20px";
                document.getElementsByClassName(Bubbles[y][x])[0].children[2].style.fontSize = "13px";


                for(let c = 0;c<document.getElementsByClassName(Bubbles[y][x])[0].children[3].children.length;c++){
                    document.getElementsByClassName(Bubbles[y][x])[0].children[3].children[c].style.fontSize = "30px";
                    document.getElementsByClassName(Bubbles[y][x])[0].children[3].children[c].style.marginLeft = "5px";
                    document.getElementsByClassName(Bubbles[y][x])[0].children[3].children[c].style.marginRight = "5px";
                }
                document.getElementsByClassName(Bubbles[y][x])[0].children[3].style.top = "-20%";




                if ( SqrData.Image === ""){

                }   else{
                    document.getElementsByClassName(Bubbles[y][x])[0].children[0].src = "";
                    document.getElementsByClassName(Bubbles[y][x])[0].children[0].style.width = "0";
                    document.getElementsByClassName(Bubbles[y][x])[0].children[1].textContent = SqrData.Name;
                    document.getElementsByClassName(Bubbles[y][x])[0].children[1].style.fontSize = "20px";

                    document.getElementsByClassName(Bubbles[y][x])[0].children[0].style.position = "absolute";


                }


            }else{
                 tweenSize(document.getElementsByClassName(Bubbles[y][x])[0],50,50,.3,10,true);
                xGen = 60;

                for(let c = 0;c<document.getElementsByClassName(Bubbles[y][x])[0].children[3].children.length;c++){
                    document.getElementsByClassName(Bubbles[y][x])[0].children[3].children[c].style.fontSize = "20px";
                    document.getElementsByClassName(Bubbles[y][x])[0].children[3].children[c].style.marginLeft = "-1px";
                    document.getElementsByClassName(Bubbles[y][x])[0].children[3].children[c].style.marginRight = "-1px";
                }
                document.getElementsByClassName(Bubbles[y][x])[0].children[3].style.top = "-40%";



                document.getElementsByClassName(Bubbles[y][x])[0].children[1].textContent = SqrData.Name.substring(0,1);
                document.getElementsByClassName(Bubbles[y][x])[0].children[1].style.fontSize = "26px";

                document.getElementsByClassName(Bubbles[y][x])[0].children[2].textContent = SqrData.Details;
                document.getElementsByClassName(Bubbles[y][x])[0].children[2].style.fontSize = "0";

                if ( SqrData.Image === ""){
                    document.getElementsByClassName(Bubbles[y][x])[0].children[0].style.position = "absolute";
                }   else{
                    document.getElementsByClassName(Bubbles[y][x])[0].children[1].style.fontSize = "0";
                    document.getElementsByClassName(Bubbles[y][x])[0].children[2].style.fontSize = "0";

                    document.getElementsByClassName(Bubbles[y][x])[0].children[0].style.width = "90%";
                    document.getElementsByClassName(Bubbles[y][x])[0].children[0].src = SqrData.Image;

                    document.getElementsByClassName(Bubbles[y][x])[0].children[0].style.position = "relative";
                }


            }


            // document.getElementsByClassName(Bubbles[y][x])[0].style.left = -MidX*55+XfirstPix+X+"px";
            // document.getElementsByClassName(Bubbles[y][x])[0].style.top = -MidY*55+YfirstPix+Y+"px";

            X = X+xGen;
        }

        Y = Y+yGen;
    }

    LastMidX = MidX;
    LastMidY = MidY;
};

function hex(a,b,c){
    let str = [
        '0',
        '1',
        '2',
        '3',
        '4',
        '5',
        '6',
        '7',
        '8',
        '9',
        'a',
        'b',
        'c',
        'd',
        'e',
        'f',
    ];


    let abc = function(v){
        for (let i = 0;i<str.length;i++){
            if (str[i] === v){
                return i;
            }
        }
    }

    let Red = 0;
    let Green = 0;
    let Blue = 0;



    Red = Red + abc(a.substring(0,1))*16;
    Red = Red + abc(a.substring(1,2));

    Green = Green +  abc(a.substring(2,3))*16;
    Green = Green + abc(a.substring(3,4));

    Blue = Blue + abc(a.substring(4,5))*16;
    Blue = Blue + abc(a.substring(5,6));


    Red = Red +  c * abc(b.substring(0,1))*16;
    Red = Red +  c * abc(b.substring(1,2));

    Green = Green +   c*abc(b.substring(2,3))*16;
    Green = Green +  c*abc(b.substring(3,4));

    Blue = Blue +  c*abc(b.substring(4,5))*16;
    Blue = Blue +  c*abc(b.substring(5,6));


    let re = "";


    re = re + (str[ Math.floor(Red/16)] ? str[Math.floor(Red/16)] : "f")  +  (str[Red%16] ? str[Red%16] : "f");
    re = re + (str[ Math.floor(Green/16)] ? str[Math.floor(Green/16)] : "f")  +  (str[Green%16] ? str[Green%16] : "f");
    re = re + (str[ Math.floor(Blue/16)] ? str[Math.floor(Blue/16)] : "f")  +  (str[Blue%16] ? str[Blue%16] : "f");





    return re;
}

document.addEventListener("DOMContentLoaded",   async function(){


    MessageIt("æˆ‘å€‘çš„é¤…ä¹¾ Cookie","æœ¬ç¶²ç«™ç›´æ¥ç´€éŒ„ä½¿ç”¨è€…çš„å‹•ä½œè‡³Cookieè£¡ï¼Œè‹¥æœ‰éœ€æ±‚è€…ï¼Œå¯ç›´æ¥æ¸…é™¤æœ¬ç¶²ç«™çš„Cookieã€‚");


    let fit = Math.sqrt(Squares.length) - Math.floor(Math.sqrt(Squares.length)) === 0;

    mapSize = fit ? Math.sqrt(Squares.length) : Math.floor(Math.sqrt(Squares.length))+1;


    for (let i = 0; i <mapSize; i++) {
        Bubbles[i] = [];
    }

    for (let i = 0; i < Squares.length; i++) {
        Bubbles[Math.floor(i/mapSize)][i-Math.floor(i/mapSize)*mapSize] = i;
        BubbleInfos[i] = Squares[i];
    }


    if (document.cookie === ""){
        document.cookie = "moved=0;";
    }

    for (let i = 0; i < Squares.length; i++){


        let button = document.createElement("button");
        let h2 = document.createElement("h2");
        let h6 = document.createElement("h6");
        let img = document.createElement("img");

        let states = document.createElement("div");

        h2.textContent = Squares[i].Name;
        button.style.backgroundColor = "#" + Squares[i].Color;
        h2.style.color = "#" + hex(Squares[i].Color,"333333", +1);
        h6.style.color = "#" + hex(Squares[i].Color,"111111", +1);
        button.style.borderColor = "#" + hex(Squares[i].Color,"111111", -1);

        button.style.boxShadow = "0 0  30px 3px  #"+hex(Squares[i].Color,"111111", +1);


        button.style.left = window.innerWidth/2+"px";
        button.style.top = window.innerHeight/2+"px";

        button.style.width =  "50px";
        button.style.height = "50px";

        button.id = "bubble_"+Squares[i].id;

        if(Squares[i].states){
            for (let s = 0;s<Squares[i].states.length;s++){
                let aState = document.createElement("h6");
                aState.innerText = Squares[i].states[s][0];
                aState.classList.add("aState");
                states.appendChild(aState);
            }
        }

        button.classList.add("Square");
        button.classList.add(i);

        img.classList.add("Icon");
        
        button.appendChild(img);

        button.appendChild(h2);
        button.appendChild(h6);

        states.classList.add("states");

        button.appendChild(states);


        document.getElementById("Bubbles").appendChild(button);
    }


    //document.getElementsByClassName(Bubbles[y][x])[0].style.left = -MidX*55+XfirstPix+X+"px";
    //document.getElementsByClassName(Bubbles[y][x])[0].style.top = -MidY*55+YfirstPix+Y+"px";


    await a();

    console.log(BubbleInfos);

    let parts = new URLSearchParams(  window.location.search);
    let Found = 0;
    for (let i = 0;i<BubbleInfos.length;i++){
        if (parts.get('bubble')){} else {Found= 2;break;}
        if (BubbleInfos[i].id.toLowerCase() === parts.get('bubble').toLowerCase()){
            MidY = Math.floor(i/mapSize);
            MidX = i%mapSize;
            Found = 1;
        }
    }



    if(Found){
        if (Found === 1){
            await sleep(300);
            MessageIt("æ³¡æ³¡ï¼","æ‰¾åˆ°ä½ è¦çš„æ³¡æ³¡äº†ï¼Œè«‹äº«å—å®ƒå§ï¼");

            await a();
        }

    }
    else{
        MessageIt("æ‰¾ä¸åˆ°æ³¡æ³¡ã€‚","é´¨é´¨èªªä»–å¾ˆä¸å¥½æ„æ€ï¼Œä»–æ‰¾ä¸åˆ°ä½ æƒ³è¦çš„æ³¡æ³¡ã€‚ğŸ¤”");
    }

    document.getElementById("Page").addEventListener("scroll", function() {
        const scrollTop = document.getElementById("Page").scrollTop;
        const deg = scrollTop/(document.getElementById("Page").scrollHeight-document.getElementById("Page").clientHeight);

        document.getElementById("Card").style.transform = "rotateX("+String((deg-0.5)*50)+"deg) translate(-50%, -50%)";

    });
});



let inUi = false;


let lastTimeEnt = new Date().getTime();

async function ent(a){
    if(a){
        if(inUi){
            tweenMove(document.getElementById("Card"),window.innerWidth/2,window.innerHeight/2,1,1);

        }
        return;
    }


    if (((new Date().getTime()) - lastTimeEnt)>=200){
        lastTimeEnt= new Date().getTime();
    }else{
        return;
    }



    let SqrData = BubbleInfos[MidY*mapSize+MidX];




    if (inUi){
        inUi = false;



        tweenSize(document.getElementById("Card"),100,0,1,6);
        tweenMove(document.getElementById("Card"),window.innerWidth/2,window.innerHeight,0.000001,1);

        document.getElementById("TopBar").style.borderWidth =  "0";
        document.getElementById("TopBar").style.borderColor = "rgba(0,0,0,0)";


        await sleep(100);

        document.getElementById("TopBarImg").src = "";
        document.getElementById("TopBarText").textContent = "";

        tweenMove(document.getElementById("Card"),0,-300,0.000001,1);

        let n = document.getElementsByClassName("Case").length;
        for (let i =0 ;i<n;i++){
            document.getElementById("Page").removeChild(document.getElementsByClassName("Case")[document.getElementsByClassName("Case").length-1]);
        }


        async function _blur(){
            for (let i = 10;i>0;i--){
                document.getElementById("BackGround").style.filter = "blur("+String(i-1)+"px)";
                await sleep(50);
            }

        }
        _blur();



    }else{
        inUi = true;

         tweenSize(document.getElementsByClassName(Bubbles[MidY][MidX])[0],96,96,1,10,true);
        await sleep(70);
         tweenSize(document.getElementsByClassName(Bubbles[MidY][MidX])[0],110,110,1,10,true);

        if (SqrData.id === "7sf") MessageIt("å¤ªé™½é­šï¼","å¤ªé™½é­šæ˜¯Hxxæœ€å¥½çš„å¥½å‹ã€‚Hxxå°æˆ‘çš„æ„›éƒ½è½‰ç§»åˆ°äº†ä»–èº«ä¸Šå•Šï¼ï¼ï¼ğŸ˜­");
        if (SqrData.id === "m100") MessageIt("100æ¬¡ç§»å‹•ï¼","æ­å–œå®Œæˆ100æ¬¡ç§»å‹•ï¼ğŸ˜—");
        if (SqrData.id === "minecraft") MessageIt("Minecraftï¼","è©±èªªä½ ç©éMinecraftå—ï¼Ÿ å¦‚æœæœ‰ï¼Œä½ å¯ä»¥æƒ³ç›¡è¾¦æ³•è¯ç¹«åˆ°Hxxä¸¦èˆ‡ä»–å…±ç©ï¼");

        document.getElementById("Card").style.backgroundColor = "#" + SqrData.Color+"AA";
        document.getElementById("Card").style.borderColor = "#" + hex(SqrData.Color,"111111",-1);
        document.getElementById("Card").style.color = "#" + hex(SqrData.Color,"311141", 1);



        document.getElementById("TopBar").style.backgroundColor =  "#" + hex(SqrData.Color,"112211",-1)+"7A";
        document.getElementById("TopBar").style.borderWidth =  "3px";
        document.getElementById("TopBar").style.borderColor =  "#" + hex(SqrData.Color,"111111",-1);


        document.getElementById("Card").style.boxShadow = "0 0 300px 30px #"+hex(SqrData.Color,"111111", +1);
        document.getElementById("TopBar").style.boxShadow =  "0 0 30px #"+hex(SqrData.Color,"333333",+1);

        document.getElementById("TopBarText").style.color =  "#" + hex(SqrData.Color,"222222", 1);



        document.getElementById("TopBarImg").src = SqrData.Image;
        document.getElementById("TopBarText").textContent = SqrData.Name;





        tweenMove(document.getElementById("Card"),window.innerWidth/2,window.innerHeight,0.000001,1);

        await sleep(50);


        document.getElementById("Card").style.height = "auto";
        document.getElementById("Card").style.width = "auto";

         tweenSize(document.getElementById("Card"),
            BubbleXSize,
             BubbleYSize
            ,.1,1);


        tweenMove(document.getElementById("Card"),window.innerWidth/2,window.innerHeight/2,1,10);

        let LoadCase =  document.createElement('div');
        let LoadBox =  document.createElement('h1');
        LoadBox.textContent = "ğŸ§";
        LoadCase.style.display = "flex";
        LoadCase.style.justifyContent = "center";
        LoadCase.style.alignItems = "center";

        LoadCase.classList.add("Case");
        LoadBox.classList.add("LoadBox");




        LoadCase.appendChild(LoadBox);
        document.getElementById("Page").appendChild(LoadCase);


        async function _blur(){
            for (let i = 0;i<10;i++){
                document.getElementById("BackGround").style.filter = "blur("+String(i+1)+"px)";
                await sleep(50);
            }
        }
        _blur();


        const Http = new XMLHttpRequest();
        const url= SqrData.Page;
        Http.open("GET", url);
        Http.send();


        Http.onload = async function() {
            await sleep(10);

            LoadCase.remove();

            if (inUi){

                let Data = JSON.parse(Http.responseText);
                for (let i = 0;i<Data.length;i++){

                    let CaseE = document.createElement('div');
                    if (i === 0) CaseE.style.paddingTop="60px";
                    CaseE.classList.add("Case");

                    let Title = Data[i]["Title"];
                    if (Title){
                        let TitleE = document.createElement('h1');
                        TitleE.textContent = Data[i]["Title"];
                        TitleE.classList.add("Title");
                        TitleE.style.color = "#" + hex(SqrData.Color,"444444", +1);
                        CaseE.appendChild(TitleE);
                    }




                    let Content = Data[i]["Content"];

                    if(Content){
                        let ContentE = document.createElement('h6');
                        ContentE.textContent = Data[i]["Content"];
                        ContentE.classList.add("Content");
                        ContentE.style.color = "#" + hex(SqrData.Color,"222222", +1);
                        CaseE.appendChild(ContentE);
                    }


                    let Images = Data[i]["Images"];

                    if (Images){
                        let ImagesCaseE = document.createElement('div');
                        ImagesCaseE.classList.add("ImagesCase");


                        for (let ImageIndex = 0 ;ImageIndex<Images.length; ImageIndex++){
                            let ImageE = document.createElement('img');
                            ImageE.classList.add("Image");
                            ImageE.src = Images[ImageIndex]["Image"];
                            ImageE.alt = Images[ImageIndex]["Text"];
                            ImageE.style.borderColor = "#" + hex(SqrData.Color,"222222", +1);




                            ImagesCaseE.appendChild(ImageE);

                        }
                        CaseE.appendChild(ImagesCaseE);
                    }

                    let Links = Data[i]["Links"];


                    if (Links){
                        let LinksCaseE = document.createElement('div');
                        LinksCaseE.classList.add("LinksCase");


                        for (let LinksIndex = 0 ;LinksIndex<Links.length; LinksIndex++){
                            let LinkE = document.createElement('a');
                            LinkE.classList.add("Link");
                            LinkE.href = Links[LinksIndex]["Link"];
                            LinkE.text = Links[LinksIndex]["Text"];
                            LinkE.style.color = "#" + hex(SqrData.Color,"444444", +1);




                            LinksCaseE.appendChild(LinkE);

                        }
                        CaseE.appendChild(LinksCaseE);
                    }

                    let Line = Data[i]["Line"];

                    if (Line){
                        let LineE = document.createElement('div');
                        LineE.classList.add("Line");
                        LineE.style.backgroundColor = "#" + hex(SqrData.Color,"222222", +1);
                        CaseE.appendChild(LineE);
                    }

                    let Videos = Data[i]["Videos"];

                    if (Videos){
                        let VideosCaseE = document.createElement('div');
                        VideosCaseE.classList.add("VideosCase");

                        for (let i = 0;i<Videos.length;i++){
                            let VideoE = document.createElement('video');
                            VideoE.classList.add("Video");
                            VideoE.src = Videos[i];

                            VideoE.controls = true;
                            VideoE.style.borderColor = "#" + hex(SqrData.Color,"222222", +1);


                            VideosCaseE.appendChild(VideoE);

                        }

                        CaseE.appendChild(VideosCaseE);


                    }



                    document.getElementById("Page").appendChild(CaseE);
                }
            }

            const scrollTop = document.getElementById("Page").scrollTop;
            const deg = (document.getElementById("Page").scrollHeight-document.getElementById("Page").clientHeight) !== 0 ?scrollTop/(document.getElementById("Page").scrollHeight-document.getElementById("Page").clientHeight) : 0.5;
            document.getElementById("Card").style.transform = "rotateX("+String((deg-0.5)*50)+"deg) translate(-50%, -50%)";
            console.log(deg);
        }



    }




}




let hasBeenMoved = false;
let isHolding = false;

let X0 = 0;
let Y0 = 0;

if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){

    window.alert("å°ä¸èµ·ï¼Œä½†æˆ‘éœ€è¦ç‰¹åˆ¥æé†’ä½ ï¼Œæœ¬ç¶²ç«™ä½¿ç”¨çš„ç¨‹å¼ç¢¼å°æ–¼ä½ç«¯è¨­å‚™ç”¨æˆ¶æ˜¯å¾ˆä¸å‹å–„çš„ï¼Œé‚„è«‹è¦‹è«’ã€‚");

    if(/iPad/i.test(navigator.userAgent)){
        BubbleXSize = 850;
        BubbleYSize = 650;
    }else{
        BubbleXSize = 800;
        BubbleYSize = 1000;
    }



    document.addEventListener('touchstart', (m) => {
        if (m.touches && m.touches.length === 1) {
             X0 = m.touches[0].clientX;
             Y0 = m.touches[0].clientY;

            if (inUi || m.button) return;

            isHolding = true;
            hasBeenMoved = false;
        }
    });

    document.addEventListener('touchmove', (m) => {
        if (m.touches && m.touches.length === 1) {
            const touch = m.touches[0];
            const x = touch.clientX;
            const y = touch.clientY;

            if (isHolding){
                if (inUi){
                    X0 = x;
                    Y0 = y;

                    return;
                }

                if (X0&&Y0){}else{
                    X0 = x;
                    Y0 = y;
                }


                if (Math.abs(x - X0  ) > 75){
                    let db =  X0-x > 0;
                    let IF = db?(MidX+1<mapSize ? (typeof  Bubbles[MidY][MidX+1]) === "number":false): (MidX-1>=0 ? (typeof  Bubbles[MidY][MidX-1]) === "number" : false);

                    hasBeenMoved = true;


                    if (IF){

                        if (db){
                            MidX=MidX+1;
                        }else{
                            MidX=MidX-1;

                        }

                        a();

                    }
                    X0 = x;


                }

                if (Math.abs(y -Y0) > 75){
                    let db =  Y0-y > 0;
                    let IF = db?(MidY+1<mapSize ? (typeof  Bubbles[MidY+1][MidX]) === "number":false): (MidY-1>=0 ? (typeof  Bubbles[MidY-1][MidX]) === "number" : false);


                    hasBeenMoved = true;


                    if (IF){
                        if (db){
                            MidY=MidY+1;
                        }else{
                            MidY=MidY-1;

                        }

                        a();


                    }
                    Y0 = y;
                }
            }
        }
    });

    document.addEventListener('touchend', (m) => {
        isHolding = false;
        if ((!hasBeenMoved || inUi )&& !m.button)  {

            if (m.target.classList[0] !== "MessageTouchBox")
            {
                let sa = function(zzz){

                    if (zzz) {
                        if(zzz.id === "body")return false;
                    }else{
                        return false;
                    }

                    if (zzz.id === "Card" ){

                        return true;
                    }else{

                        return sa( zzz.parentElement);
                    }
                }
                if (sa( m.target)){

                }else{

                    ent();
                }
            }

        }

    });
}else{
    document.addEventListener('mousedown', (m) => {
        if (inUi || m.button) return;

        isHolding = true;
        hasBeenMoved = false;

        X0 = m.clientX;
        Y0 = m.clientY;
    });


    document.addEventListener("keydown", function(event) {
        if (inUi) return;
        if (event.key === "ArrowUp") {

            if ( MidY-1 >= 0 && (typeof Bubbles[MidY-1][MidX]) === "number" ){
                MidY += -1;
            }else{

                return;
            }


            a();
        }
        if (event.key === "ArrowDown") {
            if ( MidY+1<=mapSize-1 &&  typeof Bubbles[MidY+1][MidX]  === "number" ){
                MidY += 1;
            }else{
                return;
            }

            a();
        }

        if (event.key === "ArrowLeft") {
            if (  MidX-1 >= 0 && typeof  Bubbles[MidY][MidX-1] === "number"){
                MidX += -1;
            }else{
                return;
            }

            a();
        }
        if (event.key === "ArrowRight") {
            if ( MidX+1<=mapSize-1  && typeof  Bubbles[MidY][MidX+1] === "number"){
                MidX += 1;
            }else{
                return;
            }

            a();
        }


    });

    let atSquare = -1;

    let lMSL = 0;
    document.addEventListener("keydown",  function(event) {
        if (event.key === "Enter" && !inUi) ent();
        if (event.key === "Escape" && inUi) ent();
        if (event.code === "Space" && !inUi) {

            let i=0;

            for(let y = 0; y < mapSize; y++){
                for (let x = 0; x < mapSize; x++){
                    if(i === atSquare) {
                        MidX = x;
                        MidY = y;

                        atSquare = -1;

                        a();
                        break;
                    }
                    i++;
                }
            }
        }
        if (event.code === "KeyC" && event.ctrlKey && !inUi) {
            MessageIt("æ³¡æ³¡è¶…é€£çµï¼","å·²è¤‡è£½ ã€Œ"+ BubbleInfos[atSquare].Name +"ã€çš„è¶…é€£çµã€‚")
            navigator.clipboard.writeText("https://hxx.lol/?bubble="+BubbleInfos[atSquare].id);
            atSquare = -1;
        }

        if(event.code === "KeyL" && !lMSL){
            lMSL++;
            MessageIt("æ—...æ—....æ—äº®æ•™ï¼","ä½ è§¸ç™¼äº†ä¸è©²è§¸ç™¼çš„æ±è¥¿...");
            creatBubble(LimSquares["msl"]);
            a();
        }
    });

    document.addEventListener('mouseup', (m) => {

        isHolding = false;
        if ((!hasBeenMoved || inUi )&& !m.button)  {

            if (m.target.classList[0] !== "MessageTouchBox")
            {
                let sa = function(zzz){

                    if (zzz) {
                        if(zzz.id === "body")return false;
                    }else{
                        return false;
                    }

                    if (zzz.id === "Card" ){

                        return true;
                    }else{

                        return sa( zzz.parentElement);
                    }
                }
                if (sa( m.target)){

                }else{

                    ent();
                }
            }

        }

    });





    let getDad = function (c,b){
        if (c.classList[0] === b){
            return c;
        }else{
            if(c.id === "body") return false;
            return getDad(c.parentElement,b);
        }
    }

    document.addEventListener('mousemove', (m) => {

        if (isHolding){
            if (inUi){
                X0 = m.clientX;
                Y0 = m.clientY;

                return;
            }

            if (X0&&Y0){}else{
                X0 = m.clientX;
                Y0 = m.clientY;
            }


            if (Math.abs(m.clientX - X0  ) > 75){
                let db =  X0-m.clientX > 0;
                let IF = db?(MidX+1<mapSize ? (typeof  Bubbles[MidY][MidX+1]) === "number":false): (MidX-1>=0 ? (typeof  Bubbles[MidY][MidX-1]) === "number" : false);

                hasBeenMoved = true;


                if (IF){

                    if (db){
                        MidX=MidX+1;
                    }else{
                        MidX=MidX-1;

                    }

                    a();

                }
                X0 = m.clientX;


            }

            if (Math.abs(m.clientY -Y0) > 75){
                let db =  Y0-m.clientY > 0;
                let IF = db?(MidY+1<mapSize ? (typeof  Bubbles[MidY+1][MidX]) === "number":false): (MidY-1>=0 ? (typeof  Bubbles[MidY-1][MidX]) === "number" : false);


                hasBeenMoved = true;


                if (IF){
                    if (db){
                        MidY=MidY+1;
                    }else{
                        MidY=MidY-1;

                    }

                    a();


                }
                Y0 = m.clientY;

            }
        }else{

            let doc = document.getElementById("doc")
            let states = getDad(m.target,"aState");
            let Squ = getDad(m.target,"Square");

            if(states){
                doc.style.top = m.clientY + "px";
                doc.style.left = m.clientX + "px";
                doc.style.opacity = "1";

                doc.classList.add("IsState");

                let title = "ä¸æ˜";

                for(let l = 0;l<BubbleInfos[Squ.classList[1]].states.length; l++){
                    if(BubbleInfos[Squ.classList[1]].states[l][0] === states.innerText){
                        title = BubbleInfos[Squ.classList[1]].states[l][1];
                        break;
                    }
                }

                doc.innerText = title;

                atSquare = Number(Squ.classList[1]);

            }else{

                doc.classList.remove("IsState");


                if (Squ){
                    doc.style.top = m.clientY + "px";
                    doc.style.left = m.clientX + "px";
                    doc.style.opacity = "1";


                    doc.innerText = BubbleInfos[Squ.classList[1]].Name;

                    atSquare = Number(Squ.classList[1]);

                }else{
                    atSquare = -1;
                    doc.style.opacity = "0";

                    if (m.target.classList[0] === "MessageTouchBox"){
                        let SizeBoxX_P2 =m.target.getBoundingClientRect().width/2;
                        let SizeBoxY_P2 =m.target.getBoundingClientRect().height/2;

                        let PosBoxX =m.target.getBoundingClientRect().left;
                        let PosBoxY =m.target.getBoundingClientRect().top;

                        let MouseX = m.clientX;
                        let MouseY = m.clientY;

                        let _X = ( MouseX -PosBoxX )-SizeBoxX_P2;
                        let _Y = (MouseY - PosBoxY )-SizeBoxY_P2;

                        msgStyle3d ="rotate3d("+(_X/SizeBoxX_P2*7)+" ,"+(_Y/SizeBoxY_P2*7)+ ","+((_X/SizeBoxX_P2)*(_Y/SizeBoxY_P2))+",18deg) translate(-50%,-50%)";

                        for (let i = 0;i<   document.getElementById("MessagesCase").children.length;i++){
                            document.getElementById("MessagesCase").children[i].style.transform = msgStyle3d;
                        }
                    }
                }
            }
        }
    })
}








window.addEventListener('resize', function() {
    a();
    ent(true);
});
